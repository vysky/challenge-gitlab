---
  - hosts: all
    vars:
      fqdn_file: ./fqdn
      var_fqdn: "{{ lookup('file', fqdn_file).splitlines() }}"
    tasks:
      - name: clear gitlab.rb
        lineinfile:
          path: /etc/gitlab/gitlab.rb
          regexp: ".*"
          state: absent
      - name: add external url
        lineinfile:
          path: /etc/gitlab/gitlab.rb
          line: "external_url 'https://{{ var_fqdn[0] }}'"
      - name: add letsencrypt
        lineinfile:
          path: /etc/gitlab/gitlab.rb
          line: "letsencrypt['enable'] = true"
      - name: reconfigure
        shell: gitlab-ctl reconfigure